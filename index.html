            font-size: 0.6rem; /* Reduz tamanho da data */
            color: #9ca3af; /* gray-400 */
            margin-top: 2px;
        }
        /* Cores para períodos e mesociclos (exemplo) */
        /* Aplicar cores de fundo para períodos */
        .period-preparatorio { background-color: #059669 !important; color: white !important;} /* emerald-600 */
        .period-competitivo { background-color: #dc2626 !important; color: white !important;} /* red-600 */
        .period-transitorio { background-color: #d97706 !important; color: white !important;} /* amber-600 */
         /* Cor de fallback ou default */
         .period-undefined { background-color: #374151 !important; color: #d1d5db !important; }

        /* Aplicar bordas TOP para mesociclos */
        .meso-base { border-top-color: #3b82f6; } /* blue-500 */
        .meso-desenvolvimento { border-top-color: #10b981; } /* emerald-500 */
        .meso-controlo { border-top-color: #f59e0b; } /* amber-500 */
        .meso-competicao { border-top-color: #ef4444; } /* red-500 */
        .meso-manutencao { border-top-color: #8b5cf6; } /* violet-500 */
         /* Borda default ou sem mesociclo */
        .meso-undefined { border-top-color: transparent; }

        /* Estilo para eventos (ex: ponto colorido) */
        .event-dot {
            position: absolute;
            bottom: 5px;
            left: 5px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            border: 1px solid #1f2937; /* gray-800 */
        }
        .event-competition { background-color: #facc15; } /* yellow-400 */
        .event-evaluation { background-color: #a78bfa; } /* violet-400 */
        .event-other { background-color: #60a5fa; } /* blue-400 */

        /* Indicador de Objetivo */
        .objective-indicator {
             position: absolute;
             top: 5px;
             left: 5px;
             width: 8px;
             height: 8px;
             border-radius: 50%;
             background-color: #f472b6; /* pink-400 */
             border: 1px solid #1f2937;
        }

    </style>
</head>
<body class="min-h-screen">

    <div id="app" style="display: none;">
        <!-- Navigation Bar -->
        <nav class="glass-effect sticky top-0 z-40">
           <!-- ... (código da navbar existente, sem alterações) ... -->
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex-shrink-0">
                        <div>
                            <h1 class="text-xl font-bold text-white">Planer Taekwondo <span class="text-base font-normal text-gray-300">(by Carlos Mata)</span></h1>
                             <div class="flex items-center gap-2">
                                 <span class="text-xs font-medium text-gray-400">ID de Treinador:</span>
                                 <span id="user-id-display" class="text-xs font-semibold text-gray-300"></span>
                             </div>
                        </div>
                    </div>
                    <!-- Menu para PC (escondido em ecrãs pequenos) -->
                    <div class="hidden md:block">
                        <div class="ml-10 flex items-baseline space-x-4">
                            <a href="#" id="nav-meus-planos" onclick="window.showView('training-plans-list-view')" class="nav-button text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Os Meus Planos</a>
                            <a href="#" id="nav-macrociclo" onclick="window.showView('macrociclo-view')" class="nav-button text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Macrociclo</a>
                            <a href="#" id="nav-novo-plano" onclick="window.createNewTrainingPlan()" class="nav-button text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Novo Plano</a>
                            <a href="#" id="nav-novo-exercicio" onclick="window.createNewExercise()" class="nav-button text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Novo Exercício</a>
                            <a href="#" id="nav-biblioteca" onclick="window.showView('exercise-library-view')" class="nav-button text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Biblioteca Partilhada</a>
                            <a href="#" id="nav-galeria" onclick="window.showView('image-gallery-view')" class="nav-button text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Galeria de Imagens</a>
                            <a href="#" id="nav-mapa" onclick="window.showView('content-map-view')" class="nav-button text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Mapa de Conteúdos</a>
                        </div>
                    </div>
                    <!-- Botão Hambúrguer (só aparece em ecrãs pequenos) -->
                    <div class="-mr-2 flex md:hidden">
                        <button id="mobile-menu-button" type="button" class="bg-gray-800 inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white">
                            <span class="sr-only">Abrir menu principal</span>
                            <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
             <!-- Menu Móvel (escondido por defeito) -->
            <div class="md:hidden hidden" id="mobile-menu">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <a href="#" onclick="window.showView('training-plans-list-view'); window.toggleMobileMenu();" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Os Meus Planos</a>
                    <a href="#" onclick="window.showView('macrociclo-view'); window.toggleMobileMenu();" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Macrociclo</a>
                    <a href="#" onclick="window.createNewTrainingPlan(); window.toggleMobileMenu();" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Novo Plano</a>
                    <a href="#" onclick="window.createNewExercise(); window.toggleMobileMenu();" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Novo Exercício</a>
                    <a href="#" onclick="window.showView('exercise-library-view'); window.toggleMobileMenu();" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Biblioteca Partilhada</a>
                    <a href="#" onclick="window.showView('image-gallery-view'); window.toggleMobileMenu();" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Galeria de Imagens</a>
                    <a href="#" onclick="window.showView('content-map-view'); window.toggleMobileMenu();" class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Mapa de Conteúdos</a>
                </div>
            </div>
        </nav>

        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <!-- Training Plans List View -->
            <div id="training-plans-list-view" class="p-4 md:p-0 view">
                <!-- ... (código existente da lista de planos) ... -->
                <div class="flex justify-between items-center mb-6">
                     <h2 class="text-2xl font-semibold text-white">Os Meus Planos de Treino (Privados)</h2>
                     <button onclick="window.createNewTrainingPlan()" class="btn btn-primary">Criar Novo Plano</button>
                 </div>
                 <div id="plans-list-container" class="space-y-4"></div>
            </div>

            <!-- Training Plan Editor View -->
            <div id="training-plan-editor-view" class="p-4 md:p-8 glass-effect rounded-lg hidden view">
               <!-- ... (código existente do editor de planos) ... -->
                 <h2 class="text-3xl font-bold text-white mb-6" id="editor-title">Novo Plano de Treino</h2>
                 <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8" id="plan-metadata-grid"></div>
                 <div id="training-plan-sections" class="space-y-8"></div>
                 <div class="mt-8 flex flex-wrap gap-4 justify-end items-center">
                      <div class="flex items-center gap-2 mr-4">
                          <span class="text-sm font-medium text-gray-400">Tempo Total de Treino:</span>
                          <div id="footer-calculated-total-time" class="text-lg font-bold text-white bg-gray-900 px-3 py-1 rounded-md">0 min</div>
                      </div>
                     <button onclick="window.showView('training-plans-list-view')" class="btn btn-secondary">Cancelar</button>
                     <button onclick="window.exportPlanToPDF()" class="btn btn-teal">Exportar PDF</button>
                     <button id="save-plan-btn" onclick="window.saveTrainingPlan()" class="btn btn-primary">Guardar Plano</button>
                 </div>
            </div>

            <!-- Exercise Library View -->
            <div id="exercise-library-view" class="p-4 md:p-8 glass-effect rounded-lg hidden view">
               <!-- ... (código existente da biblioteca) ... -->
                 <div class="flex justify-between items-center mb-6">
                     <h2 class="text-2xl font-semibold text-white">Biblioteca de Exercícios (Partilhada)</h2>
                     <button onclick="window.createNewExercise()" class="btn btn-primary">Adicionar Exercício</button>
                 </div>
                 <div id="exercise-list-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-x-6 gap-y-8"></div>
            </div>

            <!-- Exercise Editor View -->
            <div id="exercise-editor-view" class="p-4 md:p-8 glass-effect rounded-lg hidden view">
                <!-- ... (código existente do editor de exercícios) ... -->
                 <form id="exercise-form" class="space-y-4"></form>
                 <div id="exercise-editor-footer" class="mt-8 flex flex-wrap gap-4 justify-end">
                     {/* <!-- Buttons will be rendered here by JS --> */}
                 </div>
            </div>

            <!-- Image Gallery View -->
            <div id="image-gallery-view" class="p-4 md:p-8 glass-effect rounded-lg hidden view">
               <!-- ... (código existente da galeria) ... -->
                 <div class="flex justify-between items-center mb-6">
                     <h2 class="text-2xl font-semibold text-white">Galeria de Imagens</h2>
                     <label for="gallery-upload-input" class="btn btn-primary">
                         Carregar Nova Imagem
                         <input type="file" id="gallery-upload-input" class="hidden" accept="image/jpeg,image/png,image/gif,video/mp4,video/webm" onchange="window.handleGalleryUpload(this.files[0])">
                     </label>
                 </div>
                 <div id="image-gallery-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
            </div>

             <!-- Content Map View -->
            <div id="content-map-view" class="p-4 md:p-8 glass-effect rounded-lg hidden view">
                <!-- ... (código existente do mapa de conteúdos) ... -->
                 <div class="flex flex-wrap gap-4 justify-between items-center mb-4">
                     <h2 class="text-2xl font-semibold text-white">Mapa de Conteúdos Trabalhados</h2>
                     <div class="flex gap-2">
                         <button id="add-sessions-btn" class="btn btn-secondary">+12 Sessões</button>
                         <button id="generate-chart-btn" class="btn btn-primary">Gerar Gráfico</button>
                     </div>
                 </div>

                 <div class="mb-6" id="chart-container" style="display: none;">
                     <canvas id="content-chart"></canvas>
                     <div id="chart-legend" class="flex justify-center flex-wrap gap-x-4 gap-y-2 mt-4 text-xs">
                          <div class="flex items-center gap-2">
                              <span class="w-4 h-4 rounded" style="background-color: rgba(59, 130, 246, 0.8);"></span>
                              <span>Capacidades Físicas</span>
                          </div>
                          <div class="flex items-center gap-2">
                              <span class="w-4 h-4 rounded" style="background-color: rgba(16, 185, 129, 0.8);"></span>
                              <span>Capacidades Coordenativas</span>
                          </div>
                          <div class="flex items-center gap-2">
                              <span class="w-4 h-4 rounded" style="background-color: rgba(239, 68, 68, 0.8);"></span>
                              <span>Conteúdos Técnico Táticos</span>
                          </div>
                          <div class="flex items-center gap-2">
                              <span class="w-4 h-4 rounded" style="background-color: rgba(168, 85, 247, 0.8);"></span>
                              <span>Capacidades Psicológicas/cognitivas</span>
                          </div>
                     </div>
                 </div>

                 <div id="content-grid-container" class="grid grid-cols-8 md:grid-cols-14 gap-2">
                     {/* <!-- Session squares will be generated by JS --> */}
                 </div>
            </div>

            <!-- NOVA VIEW: Macrociclo -->
            <div id="macrociclo-view" class="p-4 md:p-8 glass-effect rounded-lg hidden view">
                <div class="flex flex-wrap gap-4 justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-white">Planeamento do Macrociclo</h2>
                    <button id="save-macrociclo-btn" onclick="window.saveMacrociclo()" class="btn btn-primary">Guardar Macrociclo</button>
                </div>

                <!-- Controles do Macrociclo -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 p-4 bg-gray-800/50 rounded-lg">
                    <div>
                        <label for="macro-season" class="block text-sm font-medium text-gray-400 mb-1">Época</label>
                        <input type="text" id="macro-season" placeholder="Ex: 2025/2026" class="w-full text-sm bg-gray-700 border-gray-600 rounded-md py-1 px-2 text-white h-[34px]" oninput="window.updateMacrocicloState('season', this.value)">
                    </div>
                    <div>
                        <label for="macro-start-date" class="block text-sm font-medium text-gray-400 mb-1">Data de Início</label>
                        <input type="date" id="macro-start-date" class="w-full text-sm bg-gray-700 border-gray-600 rounded-md py-1 px-2 text-white h-[34px]" onchange="window.updateMacrocicloState('startDate', this.value); window.renderMacrocicloGrid()">
                    </div>
                    <div>
                        <label for="macro-end-date" class="block text-sm font-medium text-gray-400 mb-1">Data de Fim</label>
                        <input type="date" id="macro-end-date" class="w-full text-sm bg-gray-700 border-gray-600 rounded-md py-1 px-2 text-white h-[34px]" onchange="window.updateMacrocicloState('endDate', this.value); window.renderMacrocicloGrid()">
                    </div>
                </div>

                <!-- Botões de Ação -->
                <div class="flex flex-wrap gap-2 mb-6">
                    <!-- TODO: Implementar Modais para estas ações -->
                     <button onclick="window.openPeriodModal()" class="btn btn-secondary text-sm">Gerir Períodos</button>
                     <button onclick="window.openMesocycleModal()" class="btn btn-secondary text-sm">Gerir Mesociclos</button>
                     <button onclick="window.openEventModal()" class="btn btn-secondary text-sm">Gerir Eventos</button>
                </div>

                <!-- Grelha de Visualização -->
                 <div id="macrociclo-grid-container" class="macro-grid bg-gray-900/50 p-4 rounded-lg overflow-x-auto min-h-[200px]">
                    {/* <!-- Semanas serão renderizadas aqui pelo JS --> */}
                    <p class="text-gray-500 italic col-span-full text-center">Defina as datas de início e fim para visualizar as semanas.</p>
                </div>
            </div>

        </main>

        <!-- Modals -->
        <!-- ... (todos os modais existentes: image-gallery, content-log, exercise-library, confirmation, firebase-rules) ... -->
        <div id="image-gallery-modal" class="modal fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50 p-4">
             <div class="modal-content bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-4xl transform transition-all">
                 <div class="flex justify-between items-center mb-4">
